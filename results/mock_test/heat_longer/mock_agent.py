#!/usr/bin/env python3
"""Mock agent script for case: heat_longer

This script uses the Oracle solver to verify the evaluation pipeline.
In a real scenario, this would be generated by an AI agent.
"""

import argparse
import json
import sys
from pathlib import Path

# Import oracle solver
sys.path.insert(0, str(Path(__file__).parent.parent))
from pdebench.oracle import generate, solve_case

# Oracle configuration (hidden from real agent)
ORACLE_CONFIG = {
  "id": "heat_longer",
  "pde": {
    "type": "heat",
    "description": "Heat equation with longer time evolution",
    "coefficients": {
      "kappa": {
        "type": "constant",
        "value": 0.5
      }
    },
    "manufactured_solution": {
      "u": "exp(-2*t)*cos(pi*x)*cos(pi*y)"
    },
    "time": {
      "t0": 0.0,
      "t_end": 0.2,
      "dt": 0.02,
      "scheme": "backward_euler"
    }
  },
  "domain": {
    "type": "unit_square"
  },
  "mesh": {
    "resolution": 140,
    "cell_type": "triangle"
  },
  "fem": {
    "family": "Lagrange",
    "degree": 1
  },
  "bc": {
    "dirichlet": {
      "on": "all",
      "value": "u"
    }
  },
  "targets": {
    "target_error": 0.05,
    "metric": "rel_L2_fe"
  },
  "expose_parameters": [
    "mesh.resolution",
    "fem.degree",
    "time.dt",
    "ksp.type",
    "ksp.rtol",
    "pc.type"
  ],
  "output": {
    "format": "npz",
    "grid": {
      "bbox": [
        0,
        1,
        0,
        1
      ],
      "nx": 45,
      "ny": 45
    },
    "save_xdmf": false
  }
}


def main():
    parser = argparse.ArgumentParser(description='PDE solver')
    parser.add_argument('--resolution', type=int, required=True)
    parser.add_argument('--degree', type=int, required=True)
    parser.add_argument('--outdir', type=str, required=True)
    args = parser.parse_args()
    
    outdir = Path(args.outdir)
    
    # Update config with provided parameters
    config = ORACLE_CONFIG.copy()
    config['mesh']['resolution'] = args.resolution
    config['fem']['degree'] = args.degree
    
    # Use oracle solver (this simulates perfect agent performance)
    generate(config, outdir)
    solve_case(config, outdir)


if __name__ == '__main__':
    main()
