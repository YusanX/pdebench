#!/usr/bin/env python3
"""Mock agent script for case: heat_grid_target

This script uses the Oracle solver to verify the evaluation pipeline.
In a real scenario, this would be generated by an AI agent.
"""

import argparse
import sys
from pathlib import Path

# Import oracle solver
sys.path.insert(0, str(Path(__file__).parent.parent.parent))
from pdebench.oracle import generate, solve_case

# Oracle configuration (hidden from real agent)
ORACLE_CONFIG = { 'bc': {'dirichlet': {'on': 'all', 'value': 'u'}},
  'domain': {'type': 'unit_square'},
  'expose_parameters': [ 'mesh.resolution',
                         'fem.degree',
                         'time.dt',
                         'ksp.type',
                         'ksp.rtol',
                         'pc.type'],
  'fem': {'degree': 1, 'family': 'Lagrange'},
  'id': 'heat_grid_target',
  'mesh': {'cell_type': 'triangle', 'resolution': 160},
  'output': { 'format': 'npz',
              'grid': {'bbox': [0, 1, 0, 1], 'nx': 50, 'ny': 50},
              'save_xdmf': False},
  'pde': { 'coefficients': {'kappa': {'type': 'constant', 'value': 1.0}},
           'description': 'Heat equation targeting grid-based metric',
           'manufactured_solution': {'u': 'exp(-t)*cos(2*pi*x)*cos(2*pi*y)'},
           'time': {'dt': 0.03, 'scheme': 'backward_euler', 't0': 0.0, 't_end': 0.15},
           'type': 'heat'},
  'targets': {'metric': 'rel_L2_grid', 'target_error': 0.01}}


def main():
    parser = argparse.ArgumentParser(description='PDE solver')
    parser.add_argument('--resolution', type=int, required=True)
    parser.add_argument('--degree', type=int, required=True)
    parser.add_argument('--outdir', type=str, required=True)
    args = parser.parse_args()
    
    outdir = Path(args.outdir)
    
    # Update config with provided parameters
    config = ORACLE_CONFIG.copy()
    config['mesh']['resolution'] = args.resolution
    config['fem']['degree'] = args.degree
    
    # Use oracle solver (this simulates perfect agent performance)
    generate(config, outdir)
    solve_case(config, outdir)


if __name__ == '__main__':
    main()
